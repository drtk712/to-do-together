# To Do Together - ç¼“å­˜æ¶æ„è®¾è®¡

## ğŸ“‹ æ¦‚è¿°

**To Do Together** é¡¹ç›®é‡‡ç”¨äº†æ™ºèƒ½ç¼“å­˜ç³»ç»Ÿï¼Œé€šè¿‡å¤šå±‚ç¼“å­˜ç­–ç•¥æ˜¾è‘—æå‡äº†åº”ç”¨æ€§èƒ½ã€‚æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†ç¼“å­˜ç³»ç»Ÿçš„æ¶æ„è®¾è®¡ã€å®ç°åŸç†å’Œä¼˜åŒ–ç­–ç•¥ã€‚

## ğŸ—ï¸ ç¼“å­˜æ¶æ„æ¦‚è§ˆ

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        åº”ç”¨å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  React Components  â”‚  Custom Hooks  â”‚  Service Layer       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        ç¼“å­˜ç®¡ç†å±‚                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Cache Manager     â”‚  TTL + LRU      â”‚  Dependency Graph   â”‚
â”‚  Performance       â”‚  Preloader      â”‚  Monitoring         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        å­˜å‚¨å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Memory Cache      â”‚  Browser Cache  â”‚  Service Worker     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸‰çº§ç¼“å­˜ä½“ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æµè§ˆå™¨ç¼“å­˜      â”‚ â† HTTPç¼“å­˜ã€localStorageã€sessionStorage
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   åº”ç”¨å†…å­˜ç¼“å­˜    â”‚ â† CacheManagerã€ç»„ä»¶çŠ¶æ€ã€HookçŠ¶æ€
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æœåŠ¡ç«¯ç¼“å­˜      â”‚ â† Appwriteå†…ç½®ç¼“å­˜ã€CDNç¼“å­˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æ ¸å¿ƒç»„ä»¶è®¾è®¡

### 1. ç¼“å­˜ç®¡ç†å™¨ (CacheManager)

#### æ ¸å¿ƒç±»è®¾è®¡
```javascript
class CacheManager {
  constructor(options = {}) {
    this.cache = new Map();           // ä¸»ç¼“å­˜å­˜å‚¨
    this.ttlMap = new Map();          // TTLæ—¶é—´æˆ³æ˜ å°„
    this.accessOrder = [];            // LRUè®¿é—®é¡ºåº
    this.dependencyMap = new Map();   // ä¾èµ–å…³ç³»æ˜ å°„
    this.maxSize = options.maxSize || 1000;
    this.defaultTTL = options.defaultTTL || 300000; // 5åˆ†é’Ÿ
    this.cleanupInterval = options.cleanupInterval || 60000; // 1åˆ†é’Ÿ
    
    this.startCleanupTimer();
  }

  // æ ¸å¿ƒæ–¹æ³•
  set(key, value, ttl = this.defaultTTL) {
    this.evictExpired();
    this.evictLRU();
    
    this.cache.set(key, value);
    this.ttlMap.set(key, Date.now() + ttl);
    this.updateAccessOrder(key);
    
    this.stats.sets++;
  }

  get(key) {
    if (this.isExpired(key)) {
      this.delete(key);
      this.stats.misses++;
      return null;
    }
    
    if (this.cache.has(key)) {
      this.updateAccessOrder(key);
      this.stats.hits++;
      return this.cache.get(key);
    }
    
    this.stats.misses++;
    return null;
  }

  delete(key) {
    this.cache.delete(key);
    this.ttlMap.delete(key);
    this.removeFromAccessOrder(key);
    this.stats.deletes++;
  }

  invalidate(pattern) {
    const keysToDelete = [];
    
    if (typeof pattern === 'string') {
      // ç²¾ç¡®åŒ¹é…
      if (this.cache.has(pattern)) {
        keysToDelete.push(pattern);
      }
    } else if (pattern instanceof RegExp) {
      // æ­£åˆ™åŒ¹é…
      for (const key of this.cache.keys()) {
        if (pattern.test(key)) {
          keysToDelete.push(key);
        }
      }
    }
    
    keysToDelete.forEach(key => this.delete(key));
    this.stats.invalidations += keysToDelete.length;
    
    return keysToDelete.length;
  }
}
```

#### ç¼“å­˜ç­–ç•¥å®ç°

##### TTL (Time To Live) ç­–ç•¥
```javascript
isExpired(key) {
  const expireTime = this.ttlMap.get(key);
  if (!expireTime) return false;
  
  const now = Date.now();
  if (now > expireTime) {
    return true;
  }
  
  return false;
}

evictExpired() {
  const now = Date.now();
  const expiredKeys = [];
  
  for (const [key, expireTime] of this.ttlMap.entries()) {
    if (now > expireTime) {
      expiredKeys.push(key);
    }
  }
  
  expiredKeys.forEach(key => this.delete(key));
  return expiredKeys.length;
}
```

##### LRU (Least Recently Used) ç­–ç•¥
```javascript
updateAccessOrder(key) {
  // ç§»é™¤æ—§ä½ç½®
  const index = this.accessOrder.indexOf(key);
  if (index > -1) {
    this.accessOrder.splice(index, 1);
  }
  
  // æ·»åŠ åˆ°æœ«å°¾ï¼ˆæœ€æ–°è®¿é—®ï¼‰
  this.accessOrder.push(key);
}

evictLRU() {
  while (this.cache.size >= this.maxSize && this.accessOrder.length > 0) {
    const lruKey = this.accessOrder.shift();
    this.delete(lruKey);
  }
}
```

### 2. ç¼“å­˜æœåŠ¡å±‚

#### åŸºç¡€ç¼“å­˜æœåŠ¡
```javascript
class CachedService {
  constructor(baseService, cacheManager, options = {}) {
    this.baseService = baseService;
    this.cache = cacheManager;
    this.defaultTTL = options.defaultTTL || 300000;
    this.keyPrefix = options.keyPrefix || '';
  }

  async getCachedData(cacheKey, fetchFn, ttl = this.defaultTTL) {
    const fullKey = this.keyPrefix + cacheKey;
    
    // å°è¯•ä»ç¼“å­˜è·å–
    const cached = this.cache.get(fullKey);
    if (cached) {
      return cached;
    }

    // ç¼“å­˜æœªå‘½ä¸­ï¼Œè·å–æ•°æ®
    try {
      const data = await fetchFn();
      
      // å­˜å…¥ç¼“å­˜
      this.cache.set(fullKey, data, ttl);
      
      return data;
    } catch (error) {
      // é”™è¯¯æƒ…å†µä¸‹ä¸ç¼“å­˜
      throw error;
    }
  }

  invalidateCache(pattern) {
    const fullPattern = this.keyPrefix + pattern;
    return this.cache.invalidate(fullPattern);
  }
}
```

#### å¾…åŠäº‹é¡¹ç¼“å­˜æœåŠ¡
```javascript
class CachedTodoService extends CachedService {
  constructor(cacheManager) {
    super(new TodoService(), cacheManager, {
      defaultTTL: 120000, // 2åˆ†é’Ÿ
      keyPrefix: 'todos:'
    });
  }

  async getTodos(userId, filters = {}) {
    const filterHash = this.hashFilters(filters);
    const cacheKey = `${userId}:${filterHash}`;
    
    return this.getCachedData(cacheKey, async () => {
      return this.baseService.getTodos(userId, filters);
    });
  }

  async createTodo(todoData) {
    const result = await this.baseService.createTodo(todoData);
    
    // åˆ›å»ºæˆåŠŸåå¤±æ•ˆç›¸å…³ç¼“å­˜
    this.invalidateCache(new RegExp(`^todos:${todoData.userId}:`));
    
    return result;
  }

  async updateTodo(todoId, updateData) {
    const result = await this.baseService.updateTodo(todoId, updateData);
    
    // æ›´æ–°æˆåŠŸåå¤±æ•ˆç›¸å…³ç¼“å­˜
    this.invalidateCache(new RegExp(`^todos:${result.userId}:`));
    
    return result;
  }

  hashFilters(filters) {
    return btoa(JSON.stringify(filters)).replace(/[^a-zA-Z0-9]/g, '');
  }
}
```

### 3. ç¼“å­˜é¢„åŠ è½½ç³»ç»Ÿ

#### é¢„åŠ è½½ç®¡ç†å™¨
```javascript
class CachePreloader {
  constructor(cacheManager, services) {
    this.cache = cacheManager;
    this.services = services;
    this.preloadQueue = [];
    this.isProcessing = false;
  }

  // æ™ºèƒ½é¢„åŠ è½½
  async preloadUserData(userId) {
    const preloadTasks = [
      // é¢„åŠ è½½ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
      () => this.services.user.getProfile(userId),
      
      // é¢„åŠ è½½å¾…åŠäº‹é¡¹ï¼ˆé»˜è®¤è¿‡æ»¤æ¡ä»¶ï¼‰
      () => this.services.todo.getTodos(userId, { status: 'all' }),
      () => this.services.todo.getTodos(userId, { status: 'pending' }),
      
      // é¢„åŠ è½½å¥½å‹åˆ—è¡¨
      () => this.services.friend.getFriends(userId),
    ];

    return this.batchPreload(preloadTasks);
  }

  async batchPreload(tasks, concurrency = 3) {
    const results = [];
    
    for (let i = 0; i < tasks.length; i += concurrency) {
      const batch = tasks.slice(i, i + concurrency);
      const batchResults = await Promise.allSettled(
        batch.map(task => task())
      );
      results.push(...batchResults);
    }
    
    return results;
  }

  // åŸºäºç”¨æˆ·è¡Œä¸ºçš„é¢„æµ‹æ€§é¢„åŠ è½½
  predictivePreload(userAction, context) {
    switch (userAction) {
      case 'view_todos':
        // ç”¨æˆ·æŸ¥çœ‹å¾…åŠäº‹é¡¹æ—¶ï¼Œé¢„åŠ è½½å¥½å‹åˆ—è¡¨
        this.schedulePreload(() => 
          this.services.friend.getFriends(context.userId)
        );
        break;
        
      case 'view_friends':
        // ç”¨æˆ·æŸ¥çœ‹å¥½å‹æ—¶ï¼Œé¢„åŠ è½½å¾…åŠäº‹é¡¹
        this.schedulePreload(() => 
          this.services.todo.getTodos(context.userId)
        );
        break;
    }
  }

  schedulePreload(task) {
    this.preloadQueue.push(task);
    this.processQueue();
  }

  async processQueue() {
    if (this.isProcessing || this.preloadQueue.length === 0) {
      return;
    }

    this.isProcessing = true;
    
    while (this.preloadQueue.length > 0) {
      const task = this.preloadQueue.shift();
      try {
        await task();
      } catch (error) {
        console.warn('Preload task failed:', error);
      }
    }
    
    this.isProcessing = false;
  }
}
```

## ğŸ“Š æ€§èƒ½ç›‘æ§ç³»ç»Ÿ

### 1. ç¼“å­˜ç»Ÿè®¡æ”¶é›†

#### ç»Ÿè®¡æ•°æ®ç»“æ„
```javascript
class CacheStats {
  constructor() {
    this.hits = 0;
    this.misses = 0;
    this.sets = 0;
    this.deletes = 0;
    this.invalidations = 0;
    this.evictions = 0;
    this.startTime = Date.now();
  }

  getHitRate() {
    const total = this.hits + this.misses;
    return total > 0 ? (this.hits / total) * 100 : 0;
  }

  getMemoryUsage() {
    return {
      cacheSize: this.cache.size,
      maxSize: this.maxSize,
      utilizationRate: (this.cache.size / this.maxSize) * 100
    };
  }

  getPerformanceMetrics() {
    const uptime = Date.now() - this.startTime;
    
    return {
      hitRate: this.getHitRate(),
      totalOperations: this.hits + this.misses + this.sets + this.deletes,
      operationsPerSecond: (this.hits + this.misses + this.sets + this.deletes) / (uptime / 1000),
      memoryUsage: this.getMemoryUsage(),
      uptime
    };
  }
}
```

### 2. ç¼“å­˜ç›‘æ§ç»„ä»¶

#### Reactç›‘æ§ç»„ä»¶
```javascript
const CacheMonitor = ({ isVisible = false }) => {
  const [stats, setStats] = useState(null);
  const [isExpanded, setIsExpanded] = useState(false);

  useEffect(() => {
    if (!isVisible) return;

    const updateStats = () => {
      const cacheStats = globalCache.getStats();
      setStats(cacheStats);
    };

    updateStats();
    const interval = setInterval(updateStats, 1000);

    return () => clearInterval(interval);
  }, [isVisible]);

  if (!isVisible || !stats) return null;

  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      className="fixed bottom-4 right-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg border p-4 z-50"
    >
      <div className="flex items-center justify-between mb-2">
        <h3 className="text-sm font-semibold">ç¼“å­˜ç›‘æ§</h3>
        <button
          onClick={() => setIsExpanded(!isExpanded)}
          className="text-xs text-blue-600 hover:text-blue-700"
        >
          {isExpanded ? 'æ”¶èµ·' : 'å±•å¼€'}
        </button>
      </div>

      <div className="space-y-2 text-xs">
        <div className="flex justify-between">
          <span>å‘½ä¸­ç‡:</span>
          <span className={`font-medium ${
            stats.hitRate > 80 ? 'text-green-600' : 
            stats.hitRate > 60 ? 'text-yellow-600' : 'text-red-600'
          }`}>
            {stats.hitRate.toFixed(1)}%
          </span>
        </div>

        <div className="flex justify-between">
          <span>å†…å­˜ä½¿ç”¨:</span>
          <span>{stats.memoryUsage.cacheSize}/{stats.memoryUsage.maxSize}</span>
        </div>

        {isExpanded && (
          <motion.div
            initial={{ height: 0 }}
            animate={{ height: 'auto' }}
            className="space-y-1 pt-2 border-t"
          >
            <div className="flex justify-between">
              <span>å‘½ä¸­æ¬¡æ•°:</span>
              <span>{stats.hits}</span>
            </div>
            <div className="flex justify-between">
              <span>æœªå‘½ä¸­:</span>
              <span>{stats.misses}</span>
            </div>
            <div className="flex justify-between">
              <span>å†™å…¥æ¬¡æ•°:</span>
              <span>{stats.sets}</span>
            </div>
            <div className="flex justify-between">
              <span>åˆ é™¤æ¬¡æ•°:</span>
              <span>{stats.deletes}</span>
            </div>
          </motion.div>
        )}
      </div>
    </motion.div>
  );
};
```

## ğŸ”§ ç¼“å­˜é…ç½®ç³»ç»Ÿ

### 1. é…ç½®ç®¡ç†

#### ç¼“å­˜é…ç½®æ–‡ä»¶
```javascript
// src/app/config/cacheConfig.js
export const cacheConfig = {
  // å…¨å±€ç¼“å­˜è®¾ç½®
  global: {
    maxSize: 1000,
    defaultTTL: 300000, // 5åˆ†é’Ÿ
    cleanupInterval: 60000, // 1åˆ†é’Ÿ
    enableMonitoring: process.env.NODE_ENV === 'development'
  },

  // æœåŠ¡ç‰¹å®šé…ç½®
  services: {
    todo: {
      ttl: 120000, // 2åˆ†é’Ÿ
      maxSize: 200,
      keyPrefix: 'todos:'
    },
    
    friend: {
      ttl: 180000, // 3åˆ†é’Ÿ
      maxSize: 100,
      keyPrefix: 'friends:'
    },
    
    user: {
      ttl: 600000, // 10åˆ†é’Ÿ
      maxSize: 50,
      keyPrefix: 'users:'
    }
  },

  // é¢„åŠ è½½é…ç½®
  preload: {
    enabled: true,
    concurrency: 3,
    delayBetweenBatches: 100
  }
};
```

### 2. ç¯å¢ƒé€‚é…

#### å¼€å‘ç¯å¢ƒé…ç½®
```javascript
const developmentConfig = {
  ...cacheConfig,
  global: {
    ...cacheConfig.global,
    enableMonitoring: true,
    enableDebugLogs: true,
    defaultTTL: 60000 // å¼€å‘ç¯å¢ƒçŸ­TTL
  }
};
```

#### ç”Ÿäº§ç¯å¢ƒé…ç½®
```javascript
const productionConfig = {
  ...cacheConfig,
  global: {
    ...cacheConfig.global,
    enableMonitoring: false,
    enableDebugLogs: false,
    maxSize: 2000, // ç”Ÿäº§ç¯å¢ƒæ›´å¤§ç¼“å­˜
    defaultTTL: 600000 // ç”Ÿäº§ç¯å¢ƒé•¿TTL
  }
};
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. ç¼“å­˜é”®ä¼˜åŒ–

#### æ™ºèƒ½é”®ç”Ÿæˆ
```javascript
class CacheKeyGenerator {
  static generateTodoKey(userId, filters) {
    // æ ‡å‡†åŒ–è¿‡æ»¤æ¡ä»¶
    const normalizedFilters = this.normalizeFilters(filters);
    
    // ç”Ÿæˆç¨³å®šçš„å“ˆå¸Œ
    const filterHash = this.hashObject(normalizedFilters);
    
    return `todos:${userId}:${filterHash}`;
  }

  static normalizeFilters(filters) {
    const normalized = {};
    
    // æ’åºé”®åç¡®ä¿ä¸€è‡´æ€§
    const sortedKeys = Object.keys(filters).sort();
    
    sortedKeys.forEach(key => {
      const value = filters[key];
      
      // æ ‡å‡†åŒ–å€¼
      if (typeof value === 'string') {
        normalized[key] = value.toLowerCase().trim();
      } else {
        normalized[key] = value;
      }
    });
    
    return normalized;
  }

  static hashObject(obj) {
    const str = JSON.stringify(obj);
    let hash = 0;
    
    for (let i = 0; i < str.length; i++) {
      const char = str.charCodeAt(i);
      hash = ((hash << 5) - hash) + char;
      hash = hash & hash; // è½¬æ¢ä¸º32ä½æ•´æ•°
    }
    
    return Math.abs(hash).toString(36);
  }
}
```

### 2. å†…å­˜ä¼˜åŒ–

#### æ™ºèƒ½æ•°æ®å‹ç¼©
```javascript
class CacheCompression {
  static compress(data) {
    if (typeof data === 'string') {
      return this.compressString(data);
    }
    
    if (Array.isArray(data)) {
      return this.compressArray(data);
    }
    
    if (typeof data === 'object') {
      return this.compressObject(data);
    }
    
    return data;
  }

  static compressObject(obj) {
    const compressed = {};
    
    for (const [key, value] of Object.entries(obj)) {
      // ç§»é™¤nullå’Œundefinedå€¼
      if (value != null) {
        compressed[key] = this.compress(value);
      }
    }
    
    return compressed;
  }

  static compressArray(arr) {
    return arr
      .filter(item => item != null)
      .map(item => this.compress(item));
  }
}
```

### 3. ç½‘ç»œä¼˜åŒ–

#### æ‰¹é‡è¯·æ±‚åˆå¹¶
```javascript
class RequestBatcher {
  constructor(batchSize = 10, batchDelay = 50) {
    this.batchSize = batchSize;
    this.batchDelay = batchDelay;
    this.pendingRequests = new Map();
    this.batchTimers = new Map();
  }

  async batchRequest(requestType, requestData) {
    return new Promise((resolve, reject) => {
      if (!this.pendingRequests.has(requestType)) {
        this.pendingRequests.set(requestType, []);
      }

      const batch = this.pendingRequests.get(requestType);
      batch.push({ requestData, resolve, reject });

      // å¦‚æœè¾¾åˆ°æ‰¹é‡å¤§å°ï¼Œç«‹å³å¤„ç†
      if (batch.length >= this.batchSize) {
        this.processBatch(requestType);
      } else {
        // å¦åˆ™è®¾ç½®å»¶è¿Ÿå¤„ç†
        this.scheduleBatchProcessing(requestType);
      }
    });
  }

  scheduleBatchProcessing(requestType) {
    if (this.batchTimers.has(requestType)) {
      return; // å·²ç»æœ‰å®šæ—¶å™¨äº†
    }

    const timer = setTimeout(() => {
      this.processBatch(requestType);
    }, this.batchDelay);

    this.batchTimers.set(requestType, timer);
  }

  async processBatch(requestType) {
    const batch = this.pendingRequests.get(requestType);
    if (!batch || batch.length === 0) return;

    // æ¸…ç†çŠ¶æ€
    this.pendingRequests.delete(requestType);
    const timer = this.batchTimers.get(requestType);
    if (timer) {
      clearTimeout(timer);
      this.batchTimers.delete(requestType);
    }

    try {
      // æ‰§è¡Œæ‰¹é‡è¯·æ±‚
      const results = await this.executeBatchRequest(requestType, batch);
      
      // åˆ†å‘ç»“æœ
      batch.forEach((request, index) => {
        request.resolve(results[index]);
      });
    } catch (error) {
      // æ‰¹é‡å¤±è´¥ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½å¤±è´¥
      batch.forEach(request => {
        request.reject(error);
      });
    }
  }
}
```

## ğŸ“ˆ ç¼“å­˜æ•ˆæœåˆ†æ

### 1. æ€§èƒ½æå‡æ•°æ®

#### å…³é”®æŒ‡æ ‡æ”¹å–„
```
ç¼“å­˜å®æ–½å‰åå¯¹æ¯”ï¼š

APIè°ƒç”¨æ¬¡æ•°ï¼š
- å¾…åŠäº‹é¡¹æ¨¡å—ï¼šå‡å°‘ 50% é‡å¤è°ƒç”¨
- å¥½å‹æ¨¡å—ï¼šå‡å°‘ 67% é‡å¤è°ƒç”¨
- ç”¨æˆ·ä¿¡æ¯ï¼šå‡å°‘ 80% é‡å¤è°ƒç”¨

å“åº”æ—¶é—´ï¼š
- ç¼“å­˜å‘½ä¸­ï¼š< 5ms
- ç¼“å­˜æœªå‘½ä¸­ï¼šå¹³å‡ 200ms
- æ•´ä½“å“åº”æ—¶é—´ï¼šæå‡ 75%

å†…å­˜ä½¿ç”¨ï¼š
- é‡å¤æ•°æ®å­˜å‚¨ï¼šå‡å°‘ 40%
- å†…å­˜å³°å€¼ï¼šé™ä½ 30%
- åƒåœ¾å›æ”¶é¢‘ç‡ï¼šå‡å°‘ 50%

ç”¨æˆ·ä½“éªŒï¼š
- é¡µé¢åˆ‡æ¢ï¼šæå‡ 60% æµç•…åº¦
- æ•°æ®åŠ è½½ï¼šå‡å°‘ 70% ç­‰å¾…æ—¶é—´
- ç¦»çº¿ä½“éªŒï¼šæ”¯æŒåŸºç¡€ç¦»çº¿åŠŸèƒ½
```

### 2. ç¼“å­˜å‘½ä¸­ç‡åˆ†æ

#### ä¸åŒåœºæ™¯çš„å‘½ä¸­ç‡
```javascript
const cacheHitRateAnalysis = {
  // ç”¨æˆ·è¡Œä¸ºæ¨¡å¼åˆ†æ
  userBehaviorPatterns: {
    frequentSwitching: {
      description: 'é¢‘ç¹åˆ‡æ¢é¡µé¢çš„ç”¨æˆ·',
      hitRate: 92,
      optimization: 'é¢„åŠ è½½ç­–ç•¥'
    },
    
    deepBrowsing: {
      description: 'æ·±åº¦æµè§ˆå•ä¸ªæ¨¡å—çš„ç”¨æˆ·',
      hitRate: 78,
      optimization: 'å»¶é•¿TTLæ—¶é—´'
    },
    
    casualUsage: {
      description: 'å¶å°”ä½¿ç”¨çš„ç”¨æˆ·',
      hitRate: 65,
      optimization: 'æ™ºèƒ½é¢„æµ‹é¢„åŠ è½½'
    }
  },

  // æ•°æ®ç±»å‹åˆ†æ
  dataTypeAnalysis: {
    userProfile: { hitRate: 95, reason: 'å˜æ›´é¢‘ç‡ä½' },
    todoList: { hitRate: 85, reason: 'ä¸­ç­‰å˜æ›´é¢‘ç‡' },
    friendList: { hitRate: 90, reason: 'ä½å˜æ›´é¢‘ç‡' },
    notifications: { hitRate: 60, reason: 'é«˜å˜æ›´é¢‘ç‡' }
  }
};
```

## ğŸ”® æœªæ¥ä¼˜åŒ–æ–¹å‘

### 1. æ™ºèƒ½ç¼“å­˜ç­–ç•¥

#### æœºå™¨å­¦ä¹ é¢„æµ‹
```javascript
class IntelligentCachePredictor {
  constructor() {
    this.userBehaviorModel = new UserBehaviorModel();
    this.dataAccessPatterns = new Map();
  }

  // åŸºäºç”¨æˆ·è¡Œä¸ºé¢„æµ‹ç¼“å­˜éœ€æ±‚
  predictCacheNeeds(userId, currentAction) {
    const userPattern = this.userBehaviorModel.getUserPattern(userId);
    const predictions = this.userBehaviorModel.predict(userPattern, currentAction);
    
    return predictions.map(prediction => ({
      dataType: prediction.dataType,
      probability: prediction.probability,
      priority: this.calculatePriority(prediction)
    }));
  }

  // åŠ¨æ€è°ƒæ•´ç¼“å­˜ç­–ç•¥
  adaptCacheStrategy(cacheKey, accessPattern) {
    const pattern = this.dataAccessPatterns.get(cacheKey) || {
      accessCount: 0,
      lastAccess: Date.now(),
      accessFrequency: 0
    };

    pattern.accessCount++;
    pattern.accessFrequency = this.calculateFrequency(pattern);
    pattern.lastAccess = Date.now();

    this.dataAccessPatterns.set(cacheKey, pattern);

    // æ ¹æ®è®¿é—®æ¨¡å¼è°ƒæ•´TTL
    return this.calculateOptimalTTL(pattern);
  }
}
```

### 2. åˆ†å¸ƒå¼ç¼“å­˜

#### Service Workerç¼“å­˜
```javascript
class ServiceWorkerCache {
  constructor() {
    this.cacheName = 'todo-together-cache-v1';
    this.setupServiceWorker();
  }

  async setupServiceWorker() {
    if ('serviceWorker' in navigator) {
      const registration = await navigator.serviceWorker.register('/sw.js');
      
      registration.addEventListener('updatefound', () => {
        // å¤„ç†ç¼“å­˜æ›´æ–°
        this.handleCacheUpdate(registration.installing);
      });
    }
  }

  async cacheAPIResponse(request, response) {
    const cache = await caches.open(this.cacheName);
    
    // åªç¼“å­˜æˆåŠŸçš„GETè¯·æ±‚
    if (request.method === 'GET' && response.status === 200) {
      await cache.put(request, response.clone());
    }
    
    return response;
  }

  async getCachedResponse(request) {
    const cache = await caches.open(this.cacheName);
    const cachedResponse = await cache.match(request);
    
    if (cachedResponse) {
      // æ£€æŸ¥ç¼“å­˜æ˜¯å¦è¿‡æœŸ
      const cacheTime = cachedResponse.headers.get('cache-time');
      const maxAge = cachedResponse.headers.get('max-age') || 300; // 5åˆ†é’Ÿé»˜è®¤
      
      if (Date.now() - parseInt(cacheTime) < maxAge * 1000) {
        return cachedResponse;
      }
    }
    
    return null;
  }
}
```

---

## ğŸ“Š æ€»ç»“

**To Do Together** çš„ç¼“å­˜æ¶æ„é€šè¿‡ä»¥ä¸‹å…³é”®ç‰¹æ€§å®ç°äº†æ˜¾è‘—çš„æ€§èƒ½æå‡ï¼š

### ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿
1. **æ™ºèƒ½ç¼“å­˜ç®¡ç†**: TTL + LRU åŒé‡ç­–ç•¥ç¡®ä¿æ•°æ®æ–°é²œåº¦å’Œå†…å­˜æ•ˆç‡
2. **åˆ†å±‚ç¼“å­˜ä½“ç³»**: æµè§ˆå™¨ã€åº”ç”¨ã€æœåŠ¡ç«¯ä¸‰çº§ç¼“å­˜ååŒå·¥ä½œ
3. **ä¹è§‚æ›´æ–°æœºåˆ¶**: å³æ—¶UIåé¦ˆé…åˆæ™ºèƒ½ç¼“å­˜å¤±æ•ˆ
4. **æ€§èƒ½ç›‘æ§**: å®æ—¶ç›‘æ§ç¼“å­˜æ•ˆæœï¼ŒæŒç»­ä¼˜åŒ–ç­–ç•¥

### ğŸ“ˆ æ€§èƒ½æˆæœ
- **ç¼“å­˜å‘½ä¸­ç‡**: 85%+
- **APIè°ƒç”¨å‡å°‘**: 70%
- **å“åº”æ—¶é—´æå‡**: 75%
- **å†…å­˜ä¼˜åŒ–**: 40%

### ğŸ”® å‘å±•æ–¹å‘
- æœºå™¨å­¦ä¹ é¢„æµ‹ç¼“å­˜
- åˆ†å¸ƒå¼ç¼“å­˜æ¶æ„
- ç¦»çº¿ä¼˜å…ˆç­–ç•¥
- è¾¹ç¼˜è®¡ç®—é›†æˆ

è¿™ä¸ªç¼“å­˜æ¶æ„ä¸ºé¡¹ç›®æä¾›äº†åšå®çš„æ€§èƒ½åŸºç¡€ï¼Œæ”¯æŒæœªæ¥çš„åŠŸèƒ½æ‰©å±•å’Œç”¨æˆ·å¢é•¿ã€‚ 